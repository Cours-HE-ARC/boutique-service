language: java

jdk: oraclejdk8

addons:
  sonarcloud:
    organization: "Cours-HE-ARC" 
    token:
      secure: 2fc5e0bfe9d59c7400536281173bf39dbc4c238e

before_install:
  - sudo apt-get update
  - sudo apt-get install jq

install:
  - npm install newman
  
before_script:
  - node --version
  - npm --version
  - node_modules/.bin/newman --version
 
script:
  - mvn clean install
  - sonar-scanner -X -Dsonar.branch.name=${TRAVIS_BRANCH} -Dsonar.projectVersion=${SONAR_VERSION} -Dsonar.projectKey=boutique-service -Dsonar.projectName=boutique-service
  - ./build/jelastic-stage-deploy.sh
  - node_modules/.bin/newman run api-tests/boutique-service.postman_collection.json -e api-tests/jelastic-stage.postman_environment.json

after_success:
  - ./build/jelastic-test-deploy.sh